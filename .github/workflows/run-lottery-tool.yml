name: Run DeGate Lottery Tool

on:
  # ğŸ‘‰ 1) æ‰‹åŠ¨è§¦å‘ï¼šæ”¯æŒä¼ å…¥è‡ªå®šä¹‰ BTC åŒºå—å“ˆå¸Œ
  workflow_dispatch:
    inputs:
      block_hash:
        description: "å¯é€‰ï¼šæŒ‡å®š BTC åŒºå—å“ˆå¸Œï¼Œç•™ç©ºåˆ™ä½¿ç”¨ç¤ºä¾‹"
        required: false
        default: ""
  # ğŸ‘‰ 2) å®šæ—¶è§¦å‘ï¼ˆæ¯å¤© UTC 00:00ï¼Œå¯æŒ‰éœ€ä¿®æ”¹æˆ–åˆ é™¤ï¼‰
  schedule:
    - cron: '0 0 * * *'

jobs:
  run-lottery:
    runs-on: ubuntu-latest

    steps:
    # 1. æ‹‰å–å½“å‰ä»“åº“ä»£ç ï¼ˆå¿…é¡»ï¼‰
    - uses: actions/checkout@v4

    # 2. å®‰è£… Python 3.12ï¼ˆè‡ªåŠ¨è®¾ç½® python å‘½ä»¤ï¼‰
    - uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    # 3. å®‰è£…ä¾èµ–ï¼ˆå½“å‰è„šæœ¬ä¸éœ€è¦ï¼Œä½†ä¿æŒå…¼å®¹ future-proofï¼‰
    - name: Install dependencies if any
      run: |
        if [ -f requirements.txt ]; then
          pip install -r requirements.txt
        fi

    # 4. æ‰§è¡Œè„šæœ¬ï¼Œæ ¹æ®æ˜¯å¦ä¼ å…¥ block_hash åˆ¤æ–­æ˜¯å¦è¾“å…¥
    - name: Run lottery-tool.py
      env:
        BLOCK_HASH: ${{ inputs.block_hash }}
      run: |
        if [ -z "$BLOCK_HASH" ]; then
          echo | python lottery-tool.py
        else
          echo "$BLOCK_HASH" | python lottery-tool.py
        fi

    # 5. ä¸Šä¼ ç»“æœæ–‡ä»¶ï¼Œæ–¹ä¾¿åœ¨ Actions é¡µé¢ä¸‹è½½
    - name: Upload lottery result
      uses: actions/upload-artifact@v4
      with:
        name: lottery-result
        path: lottery_result.json
