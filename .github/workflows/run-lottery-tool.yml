name: Run DeGate Lottery Tool

on:
  # 👉 1) 手动触发：支持传入自定义 BTC 区块哈希
  workflow_dispatch:
    inputs:
      block_hash:
        description: "可选：指定 BTC 区块哈希，留空则使用示例"
        required: false
        default: ""
  # 👉 2) 定时触发（每天 UTC 00:00，可按需修改或删除）
  schedule:
    - cron: '0 0 * * *'

jobs:
  run-lottery:
    runs-on: ubuntu-latest

    steps:
    # 1. 拉取当前仓库代码（必须）
    - uses: actions/checkout@v4

    # 2. 安装 Python 3.12（自动设置 python 命令）
    - uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    # 3. 安装依赖（当前脚本不需要，但保持兼容 future-proof）
    - name: Install dependencies if any
      run: |
        if [ -f requirements.txt ]; then
          pip install -r requirements.txt
        fi

    # 4. 执行脚本，根据是否传入 block_hash 判断是否输入
    - name: Run lottery-tool.py
      env:
        BLOCK_HASH: ${{ inputs.block_hash }}
      run: |
        if [ -z "$BLOCK_HASH" ]; then
          echo | python lottery-tool.py
        else
          echo "$BLOCK_HASH" | python lottery-tool.py
        fi

    # 5. 上传结果文件，方便在 Actions 页面下载
    - name: Upload lottery result
      uses: actions/upload-artifact@v4
      with:
        name: lottery-result
        path: lottery_result.json
